<!-- ============================================= -->
<!-- SHOWS SECTION                                -->
<!-- Upcoming and past performance dates          -->
<!-- ============================================= -->
<section id="shows" aria-labelledby="shows-heading" class="py-20 px-6 bg-gradient-to-b from-black to-purple-950/30">
    <div class="max-w-7xl mx-auto">
        <h2 class="bebas text-5xl md:text-6xl text-center mb-12 gradient-text" id="shows-heading">Upcoming Shows</h2>
        
        <!-- ==================================== -->
        <!-- UPCOMING SHOWS CONTAINER             -->
        <!-- Dynamically populated with microdata -->
        <!-- ==================================== -->
        <div class="grid gap-6 md:grid-cols-2 lg:grid-cols-3" id="shows-container">
            {{#if upcomingShows}}
                {{#each upcomingShows}}
                <div class="bg-gray-900/50 rounded-lg p-6 border border-purple-500/30 hover:border-purple-400 transition-all">
                    
                    
                    <!-- Date and Time -->
                    <div class="text-amber-500 font-bold mb-2">
                        <time datetime="{{this.date}}T{{this.startTime}}{{getTimezoneOffset this.timezone}}">
                            {{this.dayOfWeek}}, {{formatDate this.date "MMM DD"}}
                        </time>
                        {{#if this.endTime}}
                        <span class="text-gray-400 font-light ml-2">{{formatTimeRange this.startTime this.endTime}}</span>
                        {{else if this.time}}
                        <span class="text-gray-400 font-light ml-2">{{this.time}}</span>
                        {{/if}}
                    </div>
                    
                    <!-- Event Name (if different from venue) -->
                    {{#if this.name}}
                    <h3 class="text-xl font-bold mb-1 text-purple-400">{{this.name}}</h3>
                    {{/if}}
                    
                    <!-- Venue Information -->
                    <div>
                        <h4 class="text-lg font-semibold mb-2">{{this.venue.name}}</h4>
                        
                        <!-- Address -->
                        {{#if this.venue.address.streetAddress}}
                        <div>
                            {{#if this.venue.address.addressLocality}}
                            <!-- Full address with link -->
                            <a href="https://maps.google.com/?q={{encodeURIComponent this.venue.address.streetAddress}}+{{encodeURIComponent this.venue.address.addressLocality}}+{{#if this.venue.address.addressRegion}}{{encodeURIComponent this.venue.address.addressRegion}}{{else}}CA{{/if}}{{#if this.venue.address.postalCode}}+{{encodeURIComponent this.venue.address.postalCode}}{{/if}}"
                               target="_blank"
                               class="text-gray-400 hover:text-purple-400 transition-colors inline-block mb-2">
                                <span>{{this.venue.address.streetAddress}}</span><br>
                                <span>{{this.venue.address.addressLocality}}</span>, 
                                <span>{{#if this.venue.address.addressRegion}}{{this.venue.address.addressRegion}}{{else}}CA{{/if}}</span>
                            </a>
                            {{else}}
                            <!-- Street only, no link -->
                            <p class="text-gray-400 mb-2">{{this.venue.address.streetAddress}}</p>
                            {{/if}}
                        </div>
                        {{/if}}
                        
                    </div>
                    
                    <!-- Description -->
                    {{#if this.description}}
                    <p class="text-sm text-gray-400 mb-4">{{this.description}}</p>
                    {{/if}}
                    
                    
                    <!-- Age Restriction -->
                    {{#if this.ticketing.ageRestriction}}
                    <p class="text-xs text-gray-500 mb-2">{{this.ticketing.ageRestriction}}</p>
                    {{/if}}
                    
                    <!-- Action Links with Price -->
                    <div class="flex gap-4 items-center">
                        {{#if this.isFree}}
                        <span class="text-green-400 font-bold text-sm">FREE</span>
                        {{else}}
                        {{#if this.ticketing.admission}}
                        <span class="text-amber-400 font-bold text-sm">{{this.ticketing.admission}}</span>
                        {{/if}}
                        {{/if}}
                        
                        {{#if this.ticketing.link}}
                        <a href="{{this.ticketing.link}}" 
                           target="_blank" 
                           class="text-purple-400 hover:text-purple-300"
>
                            Learn More →
                        </a>
                        {{/if}}
                        {{#if this.ticketing.ticketUrl}}
                        <a href="{{this.ticketing.ticketUrl}}" 
                           target="_blank" 
                           class="text-purple-400 hover:text-purple-300 font-bold">
                            Buy Tickets →
                        </a>
                        {{/if}}
                    </div>
                    
                    <!-- Special Notes -->
                    {{#if this.specialNotes}}
                    <p class="text-xs text-gray-500 mt-3 italic">{{this.specialNotes}}</p>
                    {{/if}}
                    
                </div>
                {{/each}}
            {{else}}
                <div class="col-span-full text-center text-gray-400">
                    No upcoming shows at this time. Check back soon or join our mailing list for updates!
                </div>
            {{/if}}
        </div>

        <!-- ==================================== -->
        <!-- PAST SHOWS SECTION                   -->
        <!-- Historical performance archive        -->
        <!-- ==================================== -->
        <div class="mt-16">
            <h3 class="bebas text-3xl text-center mb-8 text-purple-400">PAST SHOWS</h3>
            <div id="past-shows-container" class="max-w-4xl mx-auto bg-gray-900/30 rounded-lg p-6">
                {{#if pastShows}}
                <div class="space-y-3">
                    {{#each (limit pastShows 3)}}
                    <div class="flex flex-col sm:flex-row sm:items-center justify-between py-2 border-b border-gray-800 last:border-0">
                        <div class="flex-1">
                            <time datetime="{{this.date}}" class="text-amber-500 text-sm font-semibold">
                                {{formatDate this.date "MMM DD, YYYY"}}
                            </time>
                            <span class="text-gray-400 mx-2">•</span>
                            {{#if this.venue.link}}
                            <a href="{{this.venue.link}}" 
                               target="_blank" 
                               class="text-gray-300 hover:text-purple-400 transition-colors"
    >
                                <span>{{this.venue.name}}</span>
                            </a>
                            {{else}}
                            <span class="text-gray-300">{{this.venue.name}}</span>
                            {{/if}}
                            <span class="text-gray-500 text-sm ml-2">
                                <span>{{this.venue.address.city}}</span>
                            </span>
                            {{#if this.performanceNotes}}
                            <span class="text-purple-400 text-sm ml-2">({{this.performanceNotes}})</span>
                            {{/if}}
                        </div>
                        <div class="text-gray-500 text-sm mt-1 sm:mt-0">{{this.time}}</div>
                    </div>
                    {{/each}}
                    
                    {{#if (gt pastShows.length 3)}}
                    <!-- Hidden shows - manually iterate over remaining shows -->
                    <div id="hidden-past-shows" class="hidden space-y-3">
                        {{#each pastShows}}
                        {{#if (gt @index 2)}}
                        <div class="flex flex-col sm:flex-row sm:items-center justify-between py-2 border-b border-gray-800 last:border-0">
                            <div class="flex-1">
                                <time datetime="{{this.date}}" class="text-amber-500 text-sm font-semibold">
                                    {{formatDate this.date "MMM DD, YYYY"}}
                                </time>
                                <span class="text-gray-400 mx-2">•</span>
                                {{#if this.venue.link}}
                                <a href="{{this.venue.link}}" 
                                   target="_blank" 
                                   class="text-gray-300 hover:text-purple-400 transition-colors"
        >
                                    <span>{{this.venue.name}}</span>
                                    </a>
                                {{else}}
                                <span class="text-gray-300">{{this.venue.name}}</span>
                                {{/if}}
                                <span class="text-gray-500 text-sm ml-2">
                                    <span>{{this.venue.address.city}}</span>
                                </span>
                            </div>
                            <div class="text-gray-500 text-sm mt-1 sm:mt-0">{{this.time}}</div>
                        </div>
                        {{/if}}
                        {{/each}}
                    </div>
                    
                    <!-- Expand/Collapse button -->
                    <button id="toggle-past-shows" 
                            onclick="togglePastShows()" 
                            class="mt-2 text-gray-600 hover:text-gray-500 transition-colors text-xs opacity-70 hover:opacity-100">
                        <span id="toggle-text" class="text-[10px] uppercase tracking-wider">{{subtract pastShows.length 3}} more</span>
                        <svg id="toggle-icon" class="inline-block w-2.5 h-2.5 ml-0.5 transition-transform" fill="currentColor" viewBox="0 0 20 20">
                            <path fill-rule="evenodd" d="M5.293 7.293a1 1 0 011.414 0L10 10.586l3.293-3.293a1 1 0 111.414 1.414l-4 4a1 1 0 01-1.414 0l-4-4a1 1 0 010-1.414z" clip-rule="evenodd"/>
                        </svg>
                    </button>
                    {{/if}}
                </div>
                {{else}}
                <p class="text-gray-400 text-center">No past shows listed</p>
                {{/if}}
            </div>
        </div>
    </div>
</section>

<script>
function togglePastShows() {
    const hiddenShows = document.getElementById('hidden-past-shows');
    const toggleText = document.getElementById('toggle-text');
    const toggleIcon = document.getElementById('toggle-icon');
    
    if (hiddenShows.classList.contains('hidden')) {
        hiddenShows.classList.remove('hidden');
        toggleText.textContent = 'less';
        toggleIcon.style.transform = 'rotate(180deg)';
    } else {
        hiddenShows.classList.add('hidden');
        toggleText.textContent = '{{subtract pastShows.length 3}} more';
        toggleIcon.style.transform = 'rotate(0deg)';
    }
}
</script>